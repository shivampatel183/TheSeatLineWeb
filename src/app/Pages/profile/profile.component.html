<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <img *ngIf="user?.avatarUrl" [src]="user?.avatarUrl" alt="Profile photo" class="avatar-image" />
      <div *ngIf="!user?.avatarUrl" class="avatar-circle">{{ getInitials() }}</div>
    </div>
    <div class="profile-info">
      <h1>{{ fullName }}</h1>
      <p class="email">{{ user?.email }}</p>
      <div class="verification-badges">
        <span class="badge badge--verified" *ngIf="user?.isEmailVerified">
          <i class="fas fa-check-circle"></i> Email Verified
        </span>
        <span class="badge badge--unverified" *ngIf="user && !user.isEmailVerified">
          <i class="fas fa-exclamation-circle"></i> Email Not Verified
        </span>
        <span class="badge badge--verified" *ngIf="user?.isPhoneVerified">
          <i class="fas fa-check-circle"></i> Phone Verified
        </span>
        <span class="badge badge--unverified" *ngIf="user && !user.isPhoneVerified && user.phoneNumber">
          <i class="fas fa-exclamation-circle"></i> Phone Not Verified
        </span>
      </div>
    </div>
    <button class="logout-btn" (click)="logout()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      Logout
    </button>
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- Personal Information Card -->
    <div class="info-card">
      <div class="card-header">
        <h2>Personal Information</h2>
        <button class="edit-btn" (click)="toggleEditMode()" *ngIf="!isEditMode">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Edit
        </button>
      </div>

      <!-- View Mode -->
      <div class="info-grid" *ngIf="!isEditMode">
        <div class="info-item">
          <label>Name</label>
          <p>{{ user?.firstName || 'Not provided' }}</p>
        </div>
        <div class="info-item">
          <label>Last Name</label>
          <p>{{ user?.lastName || 'Not provided' }}</p>
        </div>
        <div class="info-item">
          <label>Email</label>
          <p>{{ user?.email || 'Not provided' }}</p>
        </div>
        <div class="info-item">
          <label>Phone Number</label>
          <p>{{ user?.phoneNumber || 'Not provided' }}</p>
        </div>
        <div class="info-item">
          <label>Date of Birth</label>
          <p>{{ formatDate(user?.dateOfBirth) }}</p>
        </div>
        <div class="info-item">
          <label>Member Since</label>
          <p>{{ formatDate(user?.createdAt) }}</p>
        </div>
        <div class="info-item" *ngIf="user?.lastLoginAt">
          <label>Last Login</label>
          <p>{{ formatDate(user?.lastLoginAt) }}</p>
        </div>
      </div>

      <!-- Edit Mode -->
      <div class="edit-form" *ngIf="isEditMode">
        <form #profileForm="ngForm" (ngSubmit)="saveProfile(profileForm)" novalidate>
          <div class="form-grid">
            <div class="form-group">
              <label>First Name *</label>
              <input type="text" name="firstName" [(ngModel)]="editData.firstName" required #firstName="ngModel" />
              <small class="text-red-600 text-xs" *ngIf="firstName.invalid && (firstName.touched || firstName.dirty)">
                First Name is required.
              </small>
            </div>
            <div class="form-group">
              <label>Last Name *</label>
              <input type="text" name="lastName" [(ngModel)]="editData.lastName" required #lastName="ngModel" />
              <small class="text-red-600 text-xs" *ngIf="lastName.invalid && (lastName.touched || lastName.dirty)">
                Last Name is required.
              </small>
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input
                type="tel"
                name="phoneNumber"
                [(ngModel)]="editData.phoneNumber"
                pattern="^[0-9+()\\-\\s]{7,15}$"
                #phoneNumber="ngModel"
              />
              <small class="text-red-600 text-xs" *ngIf="phoneNumber.invalid && (phoneNumber.touched || phoneNumber.dirty)">
                Enter a valid phone number or leave it empty.
              </small>
            </div>
            <div class="form-group">
              <label>Date of Birth *</label>
              <input type="date" name="dateOfBirth" [(ngModel)]="editData.dateOfBirth" required #dateOfBirth="ngModel" />
              <small class="text-red-600 text-xs" *ngIf="dateOfBirth.invalid && (dateOfBirth.touched || dateOfBirth.dirty)">
                Date of Birth is required.
              </small>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="toggleEditMode()">Cancel</button>
            <button type="submit" class="btn-primary" [disabled]="profileForm.invalid || isLoading">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
